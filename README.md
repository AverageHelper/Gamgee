# Gamgee

> "There's some good in this world, Mr. Frodo, and it's worth fighting for."
>
> - J. R. R. Tolkien

A Discord bot to play around with APIs and things. As for the name, I thought it was neat. Samwise Gamgee is a name that deserves to be remembered.

## Prerequisites

This project requires [NodeJS](https://nodejs.org/) (version 12 or later), [NPM](https://npmjs.org/), and a [Discord bot account token](https://www.howtogeek.com/364225/how-to-make-your-own-discord-bot/).
To make sure you have them available on your machine,
try running the following command:

```sh
$ npm -v && node -v
6.14.11
v14.6.0
```

## Clone the Repo

```sh
$ cd path/to/parent
$ git clone https://github.com/AverageHelper/Gamgee.git
$ cd Gamgee
```

## Table of contents

- [Gamgee](#Gamgee)
  - [Prerequisites](#prerequisites)
  - [Clone the Repo](#clone-the-repo)
  - [Table of contents](#table-of-contents)
  - [Usage](#usage)
    - [Run the bot](#run-the-bot)
    - [Autogenerated Files](#autogenerated-files)
  - [Commands](#commands)
    - [`help`](#help)
    - [`config`](#config)
    - [`ping`](#ping)
    - [`video`](#video)
    - [`queue`](#queue)
    - [`sr`](#sr)
    - [`t`](#t)
    - [`video`](#video)
  - [Contributing](#contributing)
  - [Built With](#built-with)
  - [Authors](#authors)
  - [License](#license)

## Usage

### Run the bot

You'll need a Discord bot account's token. See [this awesome tutorial on how to get one](https://www.howtogeek.com/364225/how-to-make-your-own-discord-bot/).

With token in hand, create a file called `.env` in the root of this project folder. Save your token in that file, like so:

```sh
# .env

DISCORD_TOKEN=YOUR_TOKEN_GOES_HERE
```

**Do not commit this file to git** or your bot _will_ get hacked.

Install the necessary dependencies:

```sh
$ npm install
```

And start the bot:

```sh
$ npm start
```

#### Selecting a database file location

If the default database location (the `Gamgee/db/` folder) won't work for your setup, you may select a different path where our database files should go. Put it in your `.env` file:

```sh
# .env

DISCORD_TOKEN=YOUR_TOKEN_GOES_HERE
DATABASE_FOLDER=/foo/bar/baz # The database will go in this folder, at baz/db.sqlite
```

### Autogenerated Files

When run, this bot will generate some files. This is normal, and you should not bother with most of them.

- `*.log` files contain log messages that the server thinks might be useful one day. Most of these have to do with big important things the bot does without you worrying. Feel free to look in here if you're ever curious. You may delete them periodically, too.
- `db/` contains the bot's database, if you've not selected your own DB path. Don't touch this unless you know what you're doing.
- `dist/` contains the compiled bot code. What, you thought we ran the TypeScript directly? SMH my head, mate.
- `node_modules/` contains our dependent packages. This folder is _massive_, and that's on purpose. You don't need to worry about the men behind this curtain.

## Commands

All commands must begin with the configured prefix (`!` by default), or a mention to the bot. (This is handy if you forget the prefix.)

### `help`

Print out the list of available commands.

### `config`

Access the server config. This command may only be run by the server owner. This command is unavailable in DMs.

#### `help`

Prints a list of valid config keys.

#### `get [command_prefix|queue_channel]`

Gamgee responds with the current configuration value for the provided key.

#### `set [command_prefix|queue_channel] <string>`

Sets a new value for the provided key. Gamgee responds with a confirmation of the new key and value, with an option to undo.

#### `unset [command_prefix|queue_channel]`

Resets a config value to default.

### `ping`

Gamgee responds with "Pong!"

### `queue`

Manage the music queue. Running this command alone reads out a handy little message to teach folks how to use the `sr` command to add their songs to the queue.

#### `info`

Sends a private message with a mention of the current queue channel, the number of songs left in the queue, and the queue's playtime. If this command is run from the queue channel, then Gamgee just posts the message in there instead.

#### `open <channel>`

Opens a new queue in the provided channel. If a queue is currently open, it is closed in favor of this one. The old queue remains where it's at.

#### `close`

Closes the queue to new requests.

#### `restart`

Empties the current queue. All queue messages are deleted, and totals and playtime are set to zero. The queue is made fresh for a new set of requests.

This is not the recommended way to bypass queue submission limits. See the `limit` subcommand below.

#### `limit [entry-duration|cooldown] <value>`

Gets or sets a limit on the queue. To see the current value, don't provide a value after the limit name.

- `entry-duration`: The maximum duration that a song submission may have in order to enter the queue. When setting this value, enter a value in seconds, or the word `null`. The default value is `null`.
- `cooldown`: The minimum amount of time that a user must wait between song submissions. When setting this value, enter a value in seconds, or the word `null`. The default value is `null`.

### `sr <video link>`

Submit a song to the queue. Users must provide a valid YouTube or SoundCloud link in order to be considered.

### `t`

Triggers the typing indicator in the current channel. This is mostly for fun and giggles.

### `video <video link>`

Given a YouTube or SoundCloud video link, Gamgee responds with that video's title and duration.

## Contributing

We welcome contributions of all sorts! Bear in mind that `main` updates _all the time_ while we're early on. Until things quiet down and big reorganizations aren't likely, I recommend small making changes at a time.

1.  Fork it!
2.  Create your feature branch: `git checkout -b my-new-feature`
3.  Add your changes: `git add .`
4.  Commit your changes: `git commit -am 'Add some feature'`
5.  Push to the branch: `git push origin my-new-feature`
6.  Submit a pull request :sunglasses:

## Built With

- [Visual Studio Code](https://code.visualstudio.com/)
- [Discord.js](https://discord.js.org/)
- Love

## Authors

- **James Robinson** - _Initial work_ - [AverageHelper](https://github.com/AverageHelper)

## License

[GNU General Public License v3.0](LICENSE)
